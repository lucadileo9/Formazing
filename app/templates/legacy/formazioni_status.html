{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    
    <!-- Header con breadcrumb -->
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('main.dashboard') }}">
                            <i class="bi bi-house me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        Formazioni {{ status }}
                    </li>
                </ol>
            </nav>
            
            <h1 class="h2 fw-bold">
                <i class="bi bi-{% if status == 'Programmata' %}clock-history{% elif status == 'Calendarizzata' %}calendar-event{% else %}check-circle{% endif %} 
                   text-{% if status == 'Programmata' %}warning{% elif status == 'Calendarizzata' %}info{% else %}success{% endif %} me-2"></i>
                Formazioni {{ status }}
            </h1>
            <p class="text-muted">
                {% if status == 'Programmata' %}
                    Formazioni pronte per la calendarizzazione e l'invio delle comunicazioni
                {% elif status == 'Calendarizzata' %}
                    Formazioni in programma, con comunicazioni già inviate
                {% else %}
                    Formazioni completate e concluse
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Alert informativo -->
    <div class="alert alert-{% if status == 'Programmata' %}warning{% elif status == 'Calendarizzata' %}info{% else %}success{% endif %} border-0 mb-4">
        <div class="d-flex align-items-center">
            <i class="bi bi-{% if status == 'Programmata' %}exclamation-triangle{% elif status == 'Calendarizzata' %}info-circle{% else %}check-circle{% endif %} me-2"></i>
            <div>
                <strong>{{ formazioni|length }} formazioni {{ status.lower() }}</strong>
                {% if status == 'Programmata' and formazioni %}
                    - Queste formazioni sono pronte per l'invio delle comunicazioni
                {% elif status == 'Calendarizzata' and formazioni %}
                    - Comunicazioni inviate, in attesa di svolgimento
                {% elif status == 'Conclusa' and formazioni %}
                    - Formazioni completate con successo
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tabella Formazioni -->
    {% if formazioni %}
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-list-ul me-2"></i>Lista Formazioni
                    </h5>
                    <small class="text-muted">{{ formazioni|length }} elementi</small>
                </div>
            </div>
            
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">
                                    <i class="bi bi-tag me-1"></i>Nome
                                </th>
                                <th scope="col">
                                    <i class="bi bi-diagram-3 me-1"></i>Area
                                </th>
                                <th scope="col">
                                    <i class="bi bi-calendar me-1"></i>Data/Ora
                                </th>
                                <th scope="col">
                                    <i class="bi bi-collection me-1"></i>Periodo
                                </th>
                                {% if status == 'Programmata' %}
                                <th scope="col">
                                    <i class="bi bi-gear me-1"></i>Azioni
                                </th>
                                {% elif status == 'Calendarizzata' %}
                                <th scope="col">
                                    <i class="bi bi-link me-1"></i>Link Teams
                                </th>
                                <th scope="col">
                                    <i class="bi bi-gear me-1"></i>Azioni
                                </th>
                                {% else %}
                                <th scope="col">
                                    <i class="bi bi-qr-code me-1"></i>Codice
                                </th>
                                <th scope="col">
                                    <i class="bi bi-link me-1"></i>Link Teams
                                </th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for formazione in formazioni %}
                            <tr>
                                <!-- Nome -->
                                <td>
                                    <div class="fw-bold">{{ formazione.get('Nome', 'N/A') }}</div>
                                    {% if formazione.get('Codice') %}
                                        <small class="text-muted">{{ formazione['Codice'] }}</small>
                                    {% endif %}
                                </td>
                                
                                <!-- Area -->
                                <td>
                                    <span class="badge rounded-pill 
                                        {% if formazione.get('Area') == 'IT' %}bg-primary
                                        {% elif formazione.get('Area') == 'HR' %}bg-success  
                                        {% elif formazione.get('Area') == 'Marketing' %}bg-warning
                                        {% elif formazione.get('Area') == 'R&D' %}bg-info
                                        {% elif formazione.get('Area') == 'All' %}bg-dark
                                        {% else %}bg-secondary{% endif %}">
                                        {{ formazione.get('Area', 'N/A') }}
                                    </span>
                                </td>
                                
                                <!-- Data/Ora -->
                                <td>
                                    <div class="small">
                                        <i class="bi bi-calendar-date me-1"></i>
                                        {% if formazione.get('Data/Ora') %}
                                            {{ formazione['Data/Ora'] }}
                                        {% else %}
                                            <span class="text-muted">Non programmata</span>
                                        {% endif %}
                                    </div>
                                </td>
                                
                                <!-- Periodo -->
                                <td>
                                    <span class="badge 
                                        {% if formazione.get('Periodo') == 'SPRING' %}bg-light text-dark
                                        {% elif formazione.get('Periodo') == 'AUTUMN' %}bg-warning  
                                        {% elif formazione.get('Periodo') == 'ONCE' %}bg-info
                                        {% elif formazione.get('Periodo') == 'EXT' %}bg-success
                                        {% elif formazione.get('Periodo') == 'OUT' %}bg-danger
                                        {% else %}bg-secondary{% endif %}">
                                        {{ formazione.get('Periodo', 'N/A') }}
                                    </span>
                                </td>
                                
                                <!-- Azioni o Info aggiuntive -->
                                {% if status == 'Programmata' %}
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-outline-primary" 
                                                onclick="previewCommunications('{{ formazione.get('id', '') }}')">
                                            <i class="bi bi-eye me-1"></i>Anteprima
                                        </button>
                                        <button type="button" class="btn btn-primary" disabled>
                                            <i class="bi bi-send me-1"></i>Invia
                                        </button>
                                    </div>
                                </td>
                                
                                {% elif status == 'Calendarizzata' %}
                                <!-- Link Teams -->
                                <td>
                                    {% if formazione.get('Link Teams') %}
                                        <a href="{{ formazione['Link Teams'] }}" target="_blank" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-camera-video me-1"></i>Teams
                                        </a>
                                    {% else %}
                                        <span class="text-muted small">Non disponibile</span>
                                    {% endif %}
                                </td>
                                <!-- Azioni -->
                                <td>
                                    <button type="button" class="btn btn-sm btn-success" 
                                            onclick="sendFeedback('{{ formazione.get('id', '') }}')">
                                        <i class="bi bi-chat-left-text me-1"></i>Feedback
                                    </button>
                                </td>
                                
                                {% else %} <!-- Conclusa -->
                                <!-- Codice -->
                                <td>
                                    <div class="small font-monospace">
                                        {{ formazione.get('Codice', 'N/A') }}
                                    </div>
                                </td>
                                <!-- Link Teams -->
                                <td>
                                    {% if formazione.get('Link Teams') %}
                                        <a href="{{ formazione['Link Teams'] }}" target="_blank" 
                                           class="btn btn-sm btn-outline-secondary">
                                            <i class="bi bi-camera-video me-1"></i>Teams
                                        </a>
                                    {% else %}
                                        <span class="text-muted small">Non disponibile</span>
                                    {% endif %}
                                </td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% else %}
        <!-- Stato vuoto -->
        <div class="text-center py-5">
            <i class="bi bi-{% if status == 'Programmata' %}check-circle-fill text-success{% elif status == 'Calendarizzata' %}calendar-x text-muted{% else %}hourglass text-muted{% endif %} display-1 mb-3"></i>
            <h4 class="text-muted">
                {% if status == 'Programmata' %}
                    Nessuna formazione da programmare
                {% elif status == 'Calendarizzata' %}
                    Nessuna formazione calendarizzata
                {% else %}
                    Nessuna formazione conclusa
                {% endif %}
            </h4>
            <p class="text-muted">
                {% if status == 'Programmata' %}
                    Tutte le formazioni sono state calendarizzate o concluse.
                {% elif status == 'Calendarizzata' %}
                    Non ci sono formazioni in programma al momento.
                {% else %}
                    Le formazioni concluse appariranno qui.
                {% endif %}
            </p>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-1"></i>Torna alla Dashboard
            </a>
        </div>
    {% endif %}
    
    <!-- Azioni rapide -->
    {% if formazioni %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex gap-2 flex-wrap">
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Torna alla Dashboard
                </a>
                
                {% if status == 'Programmata' %}
                <button type="button" class="btn btn-outline-primary" disabled>
                    <i class="bi bi-send me-1"></i>Invia Tutte ({{ formazioni|length }})
                </button>
                {% elif status == 'Calendarizzata' %}
                <button type="button" class="btn btn-outline-success" disabled>
                    <i class="bi bi-chat-left-text me-1"></i>Richiedi Feedback Tutti
                </button>
                {% else %}
                <button type="button" class="btn btn-outline-info" disabled>
                    <i class="bi bi-download me-1"></i>Esporta Report
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- Modal placeholder per funzionalità future -->
<div class="modal fade" id="actionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Azione Formazione</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Funzionalità in sviluppo per la prossima fase del progetto.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Placeholder functions per azioni future
function previewCommunications(formazioneId) {
    console.log('Preview comunicazioni per formazione:', formazioneId);
    alert('Funzionalità in sviluppo per la prossima fase.');
}

function sendFeedback(formazioneId) {
    console.log('Invio feedback per formazione:', formazioneId);
    alert('Funzionalità in sviluppo per la prossima fase.');
}
</script>
{% endblock %}