<!-- üß© MOLECULE: Formazione Row -->
<tr>
    <!-- Nome -->
    <td>
        <div class="fw-bold">{{ formazione.get('Nome', 'N/A') }}</div>
        {% if formazione.get('Codice') %}
            <small class="text-muted">{{ formazione['Codice'] }}</small>
        {% endif %}
    </td>
    
    <!-- Area -->
    <td>
        {% set area = formazione.get('Area', 'N/A') | format_area %}
        {% set area_upper = area|upper if area else 'N/A' %}
        {% set text = area %}
        
        {# Matching robusto case-insensitive #}
        {% if 'IT' in area_upper or 'INFO' in area_upper or 'TECH' in area_upper %}
            {% set color = 'bg-primary' %}
            {% set icon = 'bi bi-laptop' %}
        {% elif 'R&D' in area_upper or 'R&amp;D' in area_upper or 'RICERCA' in area_upper or 'DEVELOP' in area_upper %}
            {% set color = 'bg-danger' %}
            {% set icon = 'bi bi-lightbulb' %}
        {% elif 'MARKET' in area_upper %}
            {% set color = 'bg-purple' %}
            {% set icon = 'bi bi-megaphone' %}
        {% elif 'COMMERC' in area_upper or 'SALES' in area_upper or 'VEND' in area_upper %}
            {% set color = 'text-bg-warning' %}
            {% set icon = 'bi bi-briefcase' %}
        {% elif 'LEGAL' in area_upper or 'LEGALE' in area_upper or 'GIURID' in area_upper %}
            {% set color = 'bg-brown' %}
            {% set icon = 'bi bi-shield-check' %}
        {% elif 'HR' in area_upper or 'HUMAN' in area_upper or 'RISORSE' in area_upper %}
            {% set color = 'bg-success' %}
            {% set icon = 'bi bi-people' %}
        {% elif 'ALL' in area_upper or 'TUTT' in area_upper or 'GENER' in area_upper %}
            {% set color = 'bg-pink' %}
            {% set icon = 'bi bi-grid' %}
        {% elif area == 'N/A' or not area %}
            {% set color = 'bg-secondary' %}
            {% set icon = 'bi bi-dash-circle' %}
            {% set text = 'Non specificata' %}
        {% else %}
            {# Fallback con colore neutro per valori sconosciuti #}
            {% set color = 'bg-secondary text-light' %}
            {% set icon = 'bi bi-tag' %}
        {% endif %}
        
        {% include 'atoms/badge.html' %}
    </td>
    
    <!-- Data/Ora -->
    <td>
        <div class="small">
            {% set name = 'bi bi-calendar-date' %}
            {% set size = 'me-1' %}
            {% set color = 'text-muted' %}
            {% include 'atoms/icon.html' %}
            {{ formazione.get('Data/Ora', 'Non programmata') }}
        </div>
    </td>
    
    <!-- Periodo -->
    <td>
        {% set periodo = formazione.get('Periodo', 'N/A') %}
        {% set periodo_upper = periodo|upper if periodo else 'N/A' %}
        {% set text = periodo %}
        
        {# Matching pi√π robusto con varianti multiple #}
        {% if 'SPRING' in periodo_upper or 'PRIMAV' in periodo_upper %}
            {% set color = 'bg-success' %}
            {% set icon = 'bi bi-flower1' %}
        {% elif 'AUTUMN' in periodo_upper or 'AUTUN' in periodo_upper or 'FALL' in periodo_upper %}
            {% set color = 'bg-brown' %}
            {% set icon = 'bi bi-leaf' %}
        {% elif 'ONCE' in periodo_upper or 'UNA' in periodo_upper or 'TANTUM' in periodo_upper %}
            {% set color = 'text-bg-dark' %}
            {% set icon = 'bi bi-calendar-check' %}
        {% elif 'EXT' in periodo_upper or 'EXTERN' in periodo_upper or 'FUORI' in periodo_upper %}
            {% set color = 'bg-pink' %}
            {% set icon = 'bi bi-box-arrow-up-right' %}
        {% elif 'OUT' in periodo_upper or 'PROGRAM' in periodo_upper %}
            {% set color = 'bg-warning' %}
            {% set icon = 'bi bi-exclamation-octagon' %}
        {% elif periodo == 'N/A' or not periodo %}
            {% set color = 'bg-secondary' %}
            {% set icon = 'bi bi-dash-circle' %}
            {% set text = 'Non specificato' %}
        {% else %}
            {# Fallback con colore neutro per valori sconosciuti #}
            {% set color = 'bg-secondary text-light' %}
            {% set icon = 'bi bi-calendar3' %}
        {% endif %}
        
        {% include 'atoms/badge.html' %}
    </td>
    
    <!-- Azioni -->
    <td>
        <div class="d-flex gap-2">
            {% if formazione.get('Stato') == 'Programmata' %}
                <!-- Preview Calendarizzazione per formazioni Programmate -->
                <a href="{{ url_for('main.preview_notification_page', training_id=formazione.get('_notion_id', '')) }}" 
                   class="btn btn-primary btn-sm">
                    <i class="bi bi-eye me-1"></i>Preview Calendarizzazione
                </a>
            {% elif formazione.get('Stato') == 'Calendarizzata' %}
                <!-- Preview Feedback per formazioni Calendarizzate -->
                <a href="{{ url_for('main.preview_feedback_page', training_id=formazione.get('_notion_id', '')) }}" 
                   class="btn btn-success btn-sm">
                    <i class="bi bi-chat-left-text me-1"></i>Preview Feedback
                </a>
            {% else %}
                <!-- Nessuna azione per formazioni Concluse -->
                <span class="badge bg-success">
                    <i class="bi bi-check-circle me-1"></i>Completata
                </span>
            {% endif %}
        </div>
    </td>
</tr>