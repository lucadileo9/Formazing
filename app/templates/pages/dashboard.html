{% extends "layout/auth_required.html" %}

{% block page_content %}
    <!-- Dashboard Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="h2 fw-bold">
                {% set name = 'bi bi-speedometer2' %}
                {% set size = 'text-primary me-2' %}
                {% include 'atoms/icon.html' %}
                Dashboard Formazioni
            </h1>
            <p class="text-muted">Panoramica completa di tutte le formazioni da Notion</p>
        </div>
    </div>

    <!-- Statistics Section -->
    {% include 'organisms/dashboard_stats.html' %}

    <!-- Tabs Navigation with Content -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white">
            <ul class="nav nav-tabs card-header-tabs" id="formazioniTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="programmata-tab" data-bs-toggle="tab" 
                            data-bs-target="#programmata" type="button" role="tab">
                        {% set name = 'bi bi-clock' %}
                        {% set size = 'me-1' %}
                        {% include 'atoms/icon.html' %}
                        Programmate ({{ stats.programmata }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="calendarizzata-tab" data-bs-toggle="tab" 
                            data-bs-target="#calendarizzata" type="button" role="tab">
                        {% set name = 'bi bi-calendar-event' %}
                        {% set size = 'me-1' %}
                        {% include 'atoms/icon.html' %}
                        Calendarizzate ({{ stats.calendarizzata }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="conclusa-tab" data-bs-toggle="tab" 
                            data-bs-target="#conclusa" type="button" role="tab">
                        {% set name = 'bi bi-check-circle' %}
                        {% set size = 'me-1' %}
                        {% include 'atoms/icon.html' %}
                        Concluse ({{ stats.conclusa }})
                    </button>
                </li>
            </ul>
        </div>

        <div class="card-body">
            <div class="tab-content" id="formazioniTabsContent">
                
                <!-- Programmate Tab -->
                <div class="tab-pane fade show active" id="programmata" role="tabpanel">
                    {% if formazioni_programmata %}
                        <div class="alert alert-warning border-0 mb-3">
                            {% set name = 'bi bi-exclamation-triangle' %}
                            {% set size = 'me-2' %}
                            {% include 'atoms/icon.html' %}
                            <strong>Formazioni da calendarizzare:</strong> Queste formazioni sono pronte per l'invio delle comunicazioni.
                        </div>
                        {% set formazioni = formazioni_programmata %}
                        {% include 'organisms/formazioni_table.html' %}
                    {% else %}
                        <div class="text-center py-5">
                            {% set name = 'bi bi-check-circle-fill' %}
                            {% set size = 'text-success display-1 mb-3' %}
                            {% include 'atoms/icon.html' %}
                            <h4 class="text-muted">Nessuna formazione da programmare</h4>
                            <p class="text-muted">Tutte le formazioni sono state calendarizzate o concluse.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Calendarizzate Tab -->
                <div class="tab-pane fade" id="calendarizzata" role="tabpanel">
                    {% if formazioni_calendarizzata %}
                        <div class="alert alert-info border-0 mb-3">
                            {% set name = 'bi bi-info-circle' %}
                            {% set size = 'me-2' %}
                            {% include 'atoms/icon.html' %}
                            <strong>Formazioni in programma:</strong> Comunicazioni inviate, in attesa di svolgimento.
                        </div>
                        {% set formazioni = formazioni_calendarizzata %}
                        {% include 'organisms/formazioni_table.html' %}
                    {% else %}
                        <div class="text-center py-5">
                            {% set name = 'bi bi-calendar-x' %}
                            {% set size = 'text-muted display-1 mb-3' %}
                            {% include 'atoms/icon.html' %}
                            <h4 class="text-muted">Nessuna formazione calendarizzata</h4>
                            <p class="text-muted">Non ci sono formazioni in programma al momento.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Concluse Tab -->
                <div class="tab-pane fade" id="conclusa" role="tabpanel">
                    {% if formazioni_conclusa %}
                        <div class="alert alert-success border-0 mb-3">
                            {% set name = 'bi bi-check-circle' %}
                            {% set size = 'me-2' %}
                            {% include 'atoms/icon.html' %}
                            <strong>Formazioni completate:</strong> Formazioni svolte e concluse.
                        </div>
                        {% set formazioni = formazioni_conclusa %}
                        {% include 'organisms/formazioni_table.html' %}
                    {% else %}
                        <div class="text-center py-5">
                            {% set name = 'bi bi-hourglass' %}
                            {% set size = 'text-muted display-1 mb-3' %}
                            {% include 'atoms/icon.html' %}
                            <h4 class="text-muted">Nessuna formazione conclusa</h4>
                            <p class="text-muted">Le formazioni concluse appariranno qui.</p>
                        </div>
                    {% endif %}
                </div>
                
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Hide loading overlay when dashboard is fully loaded
        LoadingOverlay.hide();
    });
</script>
{% endblock %}